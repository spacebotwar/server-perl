<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Iain C Docherty - API Documents</title>
  <meta name="author" content="Iain C Docherty" />
  <meta name="description" content="The blog of Iain C Docherty" />
  <link rel="canonical" href="http://spacebotwar.com:4000/api/" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="http://spacebotwar.com:4000/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Iain C Docherty" href="http://spacebotwar.com:4000/atom.xml" />

  <link rel="stylesheet" href="http://spacebotwar.com:4000/assets/css/all.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.min.css">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <a href="/">
    <img src="/sp_ship.png" id="logo" alt="Site logo"/>
  </a>
  <h2><a href="/">SpaceBotWar</a>.</h2>
  <hr/>
  <h2>
  
    API Documents
  
  </h2>
  
    
      <h3><a href="/api/start">Start</a></h3>
    
    
      <h3><a href="/api/arena">Arena</a></h3>
    
    
      <h3><a href="/api/match">Match</a></h3>
    
  
  </h2>
  <hr/>
  <h2><a href="/blog">Blog posts</a></h2>
  <hr/>
  <h2><a href="/about">About</a></h2>
  <hr/>
  <h2><a href="/faq">FAQ</a></h2>
  <hr/>
  <div>
    <div id="social">
      Follow me:
<div id="stalker">
  
  <a title="icydee on Github" href="https://github.com/icydee">
    <i class="fa fa-github-square"></i>
  </a>
  

  

  

  

  

  

  
  <a title="Iain C Docherty on Facebook" href="https://facebook.com/icydee">
    <i class="fa fa-facebook-square"></i>
  </a>
  

  

  
  <a title="Iain C Docherty on LinkedIn" href="https://www.linkedin.com/in/icydee">
    <i class="fa fa-linkedin-square"></i>
  </a>
  

  

  <a title="RSS feed" id="rss" href="/atom.xml">
    <i class="fa fa-rss-square"></i>
  </a>
</div>

    </div>
  </div>
  </ul>
</nav>

    </div>

    <div class="eleven columns content">
      <h1 id="api_documents">API Documents</h1>

<p>This document describes the SpaceBotWar server and the open API that will enable you to interact with it.</p>

<p>The API is the same one that is used by the SpaceBotWar User Interface (UI) so anything you can do in the UI you can do from an external program.</p>

<h2 id="server">Server</h2>

<p>The playable servers are as follows.</p>

<pre><code>spacebotwar.com</code></pre>

<h2 id="web_sockets">Web Sockets</h2>

<p>The Web Servers predominatly use Web Socket technology. This offers significant advantages over HTTP requests, even AJAX calls using HTTP.</p>

<ul>
<li>The overhead for each request is much smaller making for a faster response. An AJAX call could typically have 1200 bytes of header for 8 bytes of data. For the same data in Web Socket the header is about 8 bytes.</li>

<li>It is asynchronous and full-duplex. This means the server can <em>push</em> data to the client at any time. The client no longer has to resort to frequent polling or similar techniques.</li>

<li>By only supporting Web Sockets, the server can be significantly trimmed down making it faster and cheaper. We can then scale out horizontally, providing more power at a cheaper cost.</li>
</ul>

<p>The consequence however is that your client code needs to be a little more sophisticated. We have provided several examples of simple web servers you can build upon if you wish.</p>

<h2 id="example_calls">Example Calls</h2>

<p>Here is an example connection to a Web Socket (in Perl)</p>
<div class='highlight'><pre><code class='perl'><span class='k'>use</span> <span class='nn'>AnyEvent::WebSocket::</span><span class='n'>Client</span><span class='p'>;</span>

<span class='k'>my</span> <span class='nv'>$client</span> <span class='o'>=</span> <span class='nn'>AnyEvent::WebSocket::</span><span class='n'>Client</span><span class='o'>-&gt;</span><span class='k'>new</span><span class='p'>;</span>

<span class='k'>my</span> <span class='nv'>$connection</span><span class='p'>;</span>

<span class='nv'>$client</span><span class='o'>-&gt;</span><span class='nb'>connect</span><span class='p'>(</span><span class='s'>&quot;ws://spacebotwar.com/ws/start&quot;</span><span class='p'>)</span><span class='o'>-&gt;</span><span class='n'>cb</span><span class='p'>(</span><span class='k'>sub </span><span class='p'>{</span>
    <span class='o'>...</span>
<span class='p'>});</span>
</code></pre></div>
<p>A more complete example can be found in the examples directory.</p>

<h2 id="api_hierarchy">API hierarchy</h2>

<p>The API call is split into several components.</p>

<h3 id="connection">Connection</h3>

<p>A Connection is to a specific <strong>server</strong>, there are three functional areas in Space Bot War, one that controls the game, one for the chat system, one for the system that competes players in matches. These functional areas are each served by several servers and servers are free to be added and removed as needed. To access these areas you make a connection as follows.</p>

<h4 id="start">Start</h4>

<p>Connect to the <strong>/ws/start</strong> server which will allow you to log on and to obtain the server names for all the servers controlling the operation of the game.</p>

<h4 id="lobby">Lobby</h4>

<p>The Lobby is the entry point to the chat system and is always on <strong>/ws/lobby</strong> server. From here you can obtain a list of all other chat servers.</p>

<h4 id="arena">Arena</h4>

<p>The Arena is where matches between competitors is organized. Connect to <strong>/ws/arena</strong> to get a list of all servers which are currently available.</p>

<p>Each of these three areas requires a separate Web Socket connection. You may run one connection to each functional area at a time.</p>

<h3 id="route">Route</h3>

<p>A <strong>route</strong> defines a specific command in the API and these routes use a path-like structure to group commands with similar functionality. e.g. user account commands are <strong>/user/register</strong>, <strong>/user/login</strong> and <strong>/user/logout</strong></p>

<h3 id="putting_it_together">Putting it together</h3>

<p>Putting the connection and the Route together.</p>

<ul>
<li>Connection - <strong>ws://spacebotwar.com/ws/start</strong></li>

<li>Route - <strong>/general/post_message</strong></li>
</ul>

<p>Gives the connection string of <strong>ws://spacebotwar.com/chat/general/post_message</strong></p>

<h2 id="web_socket_message_structure">Web Socket Message Structure</h2>

<p>A web-socket message has a JSON encoded string as it’s payload. This is an example of a server response.</p>
<div class='highlight'><pre><code class='json'><span class='p'>{</span> <span class='nt'>&quot;server&quot;</span> <span class='p'>:</span> <span class='s2'>&quot;Kingsley&quot;</span><span class='p'>,</span> <span class='nt'>&quot;route&quot;</span> <span class='p'>:</span> <span class='s2'>&quot;/user/register&quot;</span><span class='p'>,</span> <span class='nt'>&quot;content&quot;</span> <span class='p'>:</span> <span class='p'>{</span> <span class='nt'>&quot;code&quot;</span> <span class='p'>:</span> <span class='s2'>&quot;0&quot;</span><span class='p'>,</span> <span class='nt'>&quot;message&quot;</span> <span class='p'>:</span> <span class='s2'>&quot;Registered&quot;</span> <span class='p'>}</span> <span class='p'>}</span>
</code></pre></div>
<p>The <strong>server</strong> identifies which server the response came from. The <strong>route</strong> identifies the message and the <strong>content</strong> is the message payload.</p>

<p>This might be documented as follows</p>

<h3 id="client__register">Client : Register</h3>

<p>Send a registration message from the client to the server.</p>
<div class='highlight'><pre><code class='json'><span class='p'>{</span>
    <span class='nt'>&quot;username&quot;</span>  <span class='p'>:</span> <span class='s2'>&quot;james_bond&quot;</span><span class='p'>,</span>
    <span class='nt'>&quot;password&quot;</span>  <span class='p'>:</span> <span class='s2'>&quot;topS3cret&quot;</span><span class='p'>,</span>
    <span class='nt'>&quot;email&quot;</span>     <span class='p'>:</span> <span class='s2'>&quot;agent007@mi5.gov.co.uk&quot;</span><span class='p'>,</span>
    <span class='nt'>&quot;msg_id&quot;</span>    <span class='p'>:</span> <span class='s2'>&quot;123&quot;</span><span class='p'>,</span>
<span class='p'>}</span>
</code></pre></div>
<p>This shows a message from a client to the server. In this case a ‘registration’ for a new user.</p>

<p>The arguments are self explanatory except for the <strong>msg_id</strong></p>

<h4 id="msg_id">msg_id</h4>

<p>This is a unique number for the message. Due to the asynchronous nature of Web Sockets there is often no correlation between a client request and the server response. The <strong>msg_id</strong> is a way for the client to match a server response to an earlier client request.</p>

<p>The simplest way to implement this is to have a counter on the client which is incremented for each message sent. So sending a <em>Client : Register</em> request (message number 123) will result in a <em>Server Register</em> response with msg_id 123.</p>

<p>Note that there will be cases where the server sends messages which were not requested (such as status changes) where the msg_id will not be relevant and may not be included.</p>

      <div class="footer">
        <div class="disclaimer">
  

  <p>
    © Iain C Docherty, 2013 &mdash; 
  </p>
</div>

      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
